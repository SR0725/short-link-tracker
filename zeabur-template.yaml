# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
    name: short-link-tracker
spec:
    description: A complete URL shortener and analytics platform with PostgreSQL and Redis
    icon: https://service-icons.zeabur.com/git/nodejs/next.js.svg
    tags: 
        - Web App
        - Analytics
        - URL Shortener
    readme: |
        # çŸ­ç¶²å€è¿½è¹¤å™¨ Short Link Tracker

        åŸºæ–¼ Next.js 15 å»ºæ§‹çš„ç¾ä»£åŒ–çŸ­ç¶²å€åŠåˆ†æå¹³å°ï¼Œå…·å‚™ä»¥ä¸‹åŠŸèƒ½ï¼š

        ## âœ¨ ä¸»è¦åŠŸèƒ½
        - ğŸ”— è‡ªè¨‚åˆ¥åçš„ç¶²å€ç¸®çŸ­æœå‹™
        - ğŸ“Š å®Œæ•´çš„é»æ“Šåˆ†æèˆ‡è¿½è¹¤
        - ğŸ·ï¸ é€£çµåˆ†é¡æ¨™ç±¤ç®¡ç†
        - â° é€£çµæœ‰æ•ˆæœŸé™èˆ‡é»æ“Šæ¬¡æ•¸é™åˆ¶
        - ğŸ¨ å¯è‡ªè¨‚æ¨£å¼çš„ QR Code ç”¢ç”Ÿå™¨
        - ğŸ” ç®¡ç†å“¡å„€è¡¨æ¿èˆ‡èº«ä»½é©—è­‰
        - ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´å„ç¨®è£ç½®

        ## ğŸ›  æŠ€è¡“æ¶æ§‹
        - **å‰ç«¯**: Next.js 15, React 19, Tailwind CSS
        - **å¾Œç«¯**: Next.js API Routes
        - **è³‡æ–™åº«**: PostgreSQL with Prisma ORM
        - **å¿«å–**: Redis
        - **éƒ¨ç½²å¹³å°**: Zeabur

        ## ğŸš€ å¿«é€Ÿé–‹å§‹
        1. éƒ¨ç½²æ™‚è¨­å®šç®¡ç†å“¡å¯†ç¢¼
        2. ç­‰å¾…æœå‹™å•Ÿå‹•å®Œæˆ
        3. å‰å¾€ `/admin` ä½¿ç”¨ç®¡ç†å“¡å¸³è™Ÿç™»å…¥
        4. é–‹å§‹å»ºç«‹å’Œç®¡ç†çŸ­ç¶²å€

        ## ğŸ” é è¨­è¨­å®š
        - ç®¡ç†å“¡å¯†ç¢¼ï¼šéƒ¨ç½²æ™‚è‡ªè¨‚è¨­å®š
        - æ‰€æœ‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸éƒ½å·²é å…ˆé…ç½®

    variables:
        - key: ADMIN_PASSWORD
          type: STRING
          name: å¾Œå°å¯†ç¢¼
          description: è«‹è¨­å®šå¾Œå°å¯†ç¢¼ï¼ˆç™»å…¥çŸ­ç¶²å€å¾Œå°æ‰€ä½¿ç”¨çš„å¯†ç¢¼ï¼‰ï¼š
        - key: JWT_SECRET
          type: STRING
          name: JWT å¯†é‘°
          description: è«‹è¨­å®šç”¨æ–¼åŠ å¯† JWT Token çš„å¯†é‘°å­—ä¸²ï¼Œè«‹è¼¸å…¥ä»»æ„å­—ä¸²ï¼ˆå»ºè­°ä½¿ç”¨éš¨æ©Ÿå­—ä¸²ï¼‰
        - key: MAXMIND_LICENSE_KEY
          type: STRING
          name: MaxMind æˆæ¬Šé‡‘é‘° (é¸å¡«)
          description: IP åœ°ç†ä½ç½®æœå‹™ï¼ˆMaxMindï¼‰çš„æˆæ¬Šé‡‘é‘°ï¼Œå¦‚ä¸éœ€è¦å¯ç•™ç©ºï¼ˆç”¨æ–¼åˆ†æè¨ªå®¢ä¾†æºåœ‹å®¶ï¼‰
    services:
        - name: postgresql
          icon: https://cdn.zeabur.com/marketplace/postgresql.svg
          template: PREBUILT_V2
          spec:
            source:
                image: postgres:17
            ports:
                - id: database
                  port: 5432
                  type: TCP
            volumes:
                - id: data
                  dir: /var/lib/postgresql/data
            instructions:
                - title: Connection String
                  content: postgresql://${POSTGRES_USERNAME}:${POSTGRES_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/${POSTGRES_DATABASE}
                - title: PostgreSQL Connect Command
                  content: psql "postgresql://${POSTGRES_USERNAME}:${POSTGRES_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}/${POSTGRES_DATABASE}"
                - title: PostgreSQL username
                  content: ${POSTGRES_USERNAME}
                - title: PostgresSQL password
                  content: ${POSTGRES_PASSWORD}
                - title: PostgresSQL database
                  content: ${POSTGRES_DATABASE}
                - title: PostgreSQL host
                  content: ${PORT_FORWARDED_HOSTNAME}
                - title: PostgreSQL port
                  content: ${DATABASE_PORT_FORWARDED_PORT}
            env:
                PGDATA:
                    default: /var/lib/postgresql/data/pgdata
                    expose: false
                POSTGRES_CONNECTION_STRING:
                    default: postgresql://${POSTGRES_USERNAME}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DATABASE}
                    expose: true
                POSTGRES_DATABASE:
                    default: ${POSTGRES_DB}
                    expose: true
                POSTGRES_DB:
                    default: zeabur
                    expose: false
                POSTGRES_HOST:
                    default: ${CONTAINER_HOSTNAME}
                    expose: true
                POSTGRES_PASSWORD:
                    default: ${PASSWORD}
                    expose: true
                POSTGRES_PORT:
                    default: ${DATABASE_PORT}
                    expose: true
                POSTGRES_URI:
                    default: ${POSTGRES_CONNECTION_STRING}
                    expose: true
                POSTGRES_USER:
                    default: root
                    expose: false
                POSTGRES_USERNAME:
                    default: ${POSTGRES_USER}
                    expose: true
            configs:
                - path: /etc/postgresql/postgresql.conf
                  template: |
                    # https://github.com/postgres/postgres/blob/master/src/backend/utils/misc/postgresql.conf.sample
                    listen_addresses = '*'
                    max_connections = 100
                    shared_buffers = 128MB
                    dynamic_shared_memory_type = posix
                    max_wal_size = 1GB
                    min_wal_size = 80MB
                    log_timezone = 'Etc/UTC'
                    datestyle = 'iso, mdy'
                    timezone = 'Etc/UTC'
                    lc_messages = 'en_US.utf8'
                    lc_monetary = 'en_US.utf8'
                    lc_numeric = 'en_US.utf8'
                    lc_time = 'en_US.utf8'
                    default_text_search_config = 'pg_catalog.english'
                  permission: null
                  envsubst: null
            portForwarding:
                enabled: true
        - name: redis
          icon: https://raw.githubusercontent.com/zeabur/service-icons/main/marketplace/redis.svg
          template: PREBUILT_V2
          spec:
            source:
                image: redis/redis-stack-server:latest
            ports:
                - id: database
                  port: 6379
                  type: TCP
            volumes:
                - id: data
                  dir: /data
            instructions:
                - title: Command to connect to your Redis
                  content: redis-cli -h ${PORT_FORWARDED_HOSTNAME} -p ${DATABASE_PORT_FORWARDED_PORT} -a ${REDIS_PASSWORD}
                - title: Redis Connection String
                  content: redis://:${REDIS_PASSWORD}@${PORT_FORWARDED_HOSTNAME}:${DATABASE_PORT_FORWARDED_PORT}
                - title: Redis password
                  content: ${REDIS_PASSWORD}
                - title: Redis host
                  content: ${PORT_FORWARDED_HOSTNAME}
                - title: Redis port
                  content: ${DATABASE_PORT_FORWARDED_PORT}
            env:
                CONFFILE:
                    default: /etc/redis-stack.conf
                    expose: false
                REDIS_ARGS:
                    default: --requirepass ${REDIS_PASSWORD}
                    expose: false
                REDIS_CONNECTION_STRING:
                    default: redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}
                    expose: true
                REDIS_HOST:
                    default: ${CONTAINER_HOSTNAME}
                    expose: true
                REDIS_PASSWORD:
                    default: ${PASSWORD}
                    expose: true
                REDIS_PORT:
                    default: ${DATABASE_PORT}
                    expose: true
                REDIS_URI:
                    default: ${REDIS_CONNECTION_STRING}
                    expose: true
            configs:
                - path: /etc/redis-stack.conf
                  template: |
                    port 6379
                    daemonize no
                  permission: null
                  envsubst: null
            portForwarding:
                enabled: true
        - name: short-link-tracker
          icon: https://service-icons.zeabur.com/git/nodejs/next.js.svg
          template: PREBUILT_V2
          depends:
            - postgresql
            - redis
          spec:
            source:
                source: GITHUB
                repo: 1042274782
                branch: main
                rootDirectory: /
            ports:
                - id: web
                  port: 8080
                  type: HTTP
            env:
                NODE_ENV:
                    default: production
                    expose: false
                ADMIN_PASSWORD:
                    default: ${ADMIN_PASSWORD}
                    expose: false
                DATABASE_URL:
                    default: ${POSTGRES_CONNECTION_STRING}?schema=public
                    expose: false
                JWT_SECRET:
                    default: ${JWT_SECRET}
                    expose: false
                MAXMIND_LICENSE_KEY:
                    default: ${MAXMIND_LICENSE_KEY}
                    expose: false
                PORT:
                    default: ${WEB_PORT}
                    expose: false
                REDIS_URL:
                    default: ${REDIS_CONNECTION_STRING}
                    expose: false
            configs: []
            portForwarding:
                enabled: false
